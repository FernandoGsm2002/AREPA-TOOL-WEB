<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AREPA-TOOL Admin Panel</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Login Overlay -->
    <div id="login-overlay" class="position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center" style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); z-index: 9999;">
      <div class="card shadow-lg" style="width: 400px;">
        <div class="card-header bg-primary text-white text-center">
          <h4 class="mb-0"><i class="bi bi-shield-lock"></i> Admin Login</h4>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <label class="form-label">Username</label>
            <input type="text" class="form-control" id="login-username" placeholder="Enter username">
          </div>
          <div class="mb-3">
            <label class="form-label">Password</label>
            <input type="password" class="form-control" id="login-password" placeholder="Enter password" onkeypress="if(event.key==='Enter')doLogin()">
          </div>
          <div id="login-error" class="alert alert-danger d-none">Invalid credentials</div>
          <button class="btn btn-primary w-100" onclick="doLogin()">
            <i class="bi bi-box-arrow-in-right"></i> Login
          </button>
        </div>
      </div>
    </div>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container-fluid">
        <a class="navbar-brand fw-bold" href="#">
          <i class="bi bi-shield-check"></i> AREPA-TOOL Admin
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="#" id="adminName">Admin User</a>
            </li>
            <li class="nav-item">
              <button class="btn btn-outline-light btn-sm" onclick="logout()">
                <i class="bi bi-box-arrow-right"></i> Logout
              </button>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container-fluid mt-4">
      <div class="row">
        <!-- Sidebar -->
        <div class="col-md-2 bg-light sidebar">
          <div class="list-group list-group-flush">
            <a
              href="#"
              class="list-group-item list-group-item-action active"
              onclick="showSection('users')"
            >
              <i class="bi bi-people"></i> Users
            </a>
            <a
              href="#"
              class="list-group-item list-group-item-action"
              onclick="showSection('sessions')"
            >
              <i class="bi bi-clock-history"></i> Sessions
            </a>
            <a
              href="#"
              class="list-group-item list-group-item-action"
              onclick="showSection('audit')"
            >
              <i class="bi bi-file-text"></i> Audit Logs
            </a>
            <a
              href="#"
              class="list-group-item list-group-item-action"
              onclick="showSection('stats')"
            >
              <i class="bi bi-graph-up"></i> Statistics
            </a>
            <a
              href="#"
              class="list-group-item list-group-item-action"
              onclick="showSection('updates')"
            >
              <i class="bi bi-arrow-up-circle"></i> Updates
            </a>
            <a
              href="#"
              class="list-group-item list-group-item-action"
              onclick="showSection('announcements')"
            >
              <i class="bi bi-megaphone"></i> Announcements
            </a>
            <a
              href="#"
              class="list-group-item list-group-item-action"
              onclick="showSection('license')"
            >
              <i class="bi bi-key"></i> License Config
            </a>
            <a
              href="#"
              class="list-group-item list-group-item-action"
              onclick="showSection('bypass')"
            >
              <i class="bi bi-phone"></i> Bypass Registrations
              <span
                class="badge bg-warning ms-2"
                id="bypass-pending-count"
                style="display: none"
                >0</span
              >
            </a>
            <a
              href="#"
              class="list-group-item list-group-item-action"
              onclick="showSection('apkmanager')"
            >
              <i class="bi bi-box-seam"></i> APK Manager
            </a>
            <a
              href="#"
              class="list-group-item list-group-item-action"
              onclick="showSection('resellers')"
            >
              <i class="bi bi-people-fill"></i> Resellers
            </a>
          </div>
        </div>

        <!-- Main Content -->
        <div class="col-md-10">
          <!-- Users Section -->
          <div id="users-section" class="content-section">
            <div class="d-flex justify-content-between align-items-center mb-4">
              <h2><i class="bi bi-people"></i> User Management</h2>
              <div>
                <button class="btn btn-primary" onclick="refreshUsers()">
                  <i class="bi bi-arrow-clockwise"></i> Refresh
                </button>
              </div>
            </div>

            <!-- Filter Tabs -->
            <ul class="nav nav-tabs mb-3">
              <li class="nav-item">
                <a
                  class="nav-link active"
                  href="#"
                  onclick="filterUsers('all')"
                >
                  All <span class="badge bg-secondary" id="count-all">0</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#" onclick="filterUsers('pending')">
                  Pending
                  <span class="badge bg-warning" id="count-pending">0</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#" onclick="filterUsers('active')">
                  Active
                  <span class="badge bg-success" id="count-active">0</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#" onclick="filterUsers('suspended')">
                  Suspended
                  <span class="badge bg-danger" id="count-suspended">0</span>
                </a>
              </li>
            </ul>

            <!-- Users Table -->
            <div class="table-responsive">
              <table class="table table-hover">
                <thead class="table-light">
                  <tr>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Status</th>
                    <th>Subscription</th>
                    <th>Created</th>
                    <th style="min-width: 280px">Actions</th>
                  </tr>
                </thead>
                <tbody id="users-table-body">
                  <tr>
                    <td colspan="6" class="text-center">
                      <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Sessions Section -->
          <div
            id="sessions-section"
            class="content-section"
            style="display: none"
          >
            <h2><i class="bi bi-clock-history"></i> Active Sessions</h2>
            <div class="table-responsive mt-3">
              <table class="table table-hover">
                <thead class="table-light">
                  <tr>
                    <th>User</th>
                    <th>Device ID</th>
                    <th>IP Address</th>
                    <th>Last Activity</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="sessions-table-body">
                  <tr>
                    <td colspan="5" class="text-center">Loading...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Audit Logs Section -->
          <div id="audit-section" class="content-section" style="display: none">
            <h2><i class="bi bi-file-text"></i> Audit Logs</h2>
            <div class="table-responsive mt-3">
              <table class="table table-hover">
                <thead class="table-light">
                  <tr>
                    <th>Timestamp</th>
                    <th>User</th>
                    <th>Action</th>
                    <th>Details</th>
                  </tr>
                </thead>
                <tbody id="audit-table-body">
                  <tr>
                    <td colspan="4" class="text-center">Loading...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Statistics Section -->
          <div id="stats-section" class="content-section" style="display: none">
            <h2><i class="bi bi-graph-up"></i> Statistics</h2>
            <div class="row mt-4">
              <div class="col-md-3">
                <div class="card text-center">
                  <div class="card-body">
                    <h5 class="card-title">Total Users</h5>
                    <h2 class="text-primary" id="stat-total-users">0</h2>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="card text-center">
                  <div class="card-body">
                    <h5 class="card-title">Active Users</h5>
                    <h2 class="text-success" id="stat-active-users">0</h2>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="card text-center">
                  <div class="card-body">
                    <h5 class="card-title">Pending Approval</h5>
                    <h2 class="text-warning" id="stat-pending-users">0</h2>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="card text-center">
                  <div class="card-body">
                    <h5 class="card-title">Active Sessions</h5>
                    <h2 class="text-info" id="stat-active-sessions">0</h2>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Updates Section -->
          <div
            id="updates-section"
            class="content-section"
            style="display: none"
          >
            <div class="d-flex justify-content-between align-items-center mb-4">
              <h2>
                <i class="bi bi-arrow-up-circle"></i> App Updates Management
              </h2>
              <button class="btn btn-primary" onclick="showAddVersionModal()">
                <i class="bi bi-plus-circle"></i> Add New Version
              </button>
            </div>
            <div class="table-responsive">
              <table class="table table-hover">
                <thead class="table-light">
                  <tr>
                    <th>Version</th>
                    <th>Release Date</th>
                    <th>Download URL</th>
                    <th>Mandatory</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="versions-table-body">
                  <tr>
                    <td colspan="6" class="text-center">Loading...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Announcements Section -->
          <div
            id="announcements-section"
            class="content-section"
            style="display: none"
          >
            <div class="d-flex justify-content-between align-items-center mb-4">
              <h2><i class="bi bi-megaphone"></i> Announcements Management</h2>
              <button
                class="btn btn-primary"
                onclick="showAddAnnouncementModal()"
              >
                <i class="bi bi-plus-circle"></i> Create Announcement
              </button>
            </div>
            <div class="table-responsive">
              <table class="table table-hover">
                <thead class="table-light">
                  <tr>
                    <th>Title</th>
                    <th>Type</th>
                    <th>Priority</th>
                    <th>Target</th>
                    <th>Dates</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="announcements-table-body">
                  <tr>
                    <td colspan="7" class="text-center">Loading...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Bypass Registrations Section -->
          <div
            id="bypass-section"
            class="content-section"
            style="display: none"
          >
            <div class="d-flex justify-content-between align-items-center mb-4">
              <h2><i class="bi bi-phone"></i> Bypass Registrations</h2>
              <button
                class="btn btn-primary"
                onclick="refreshBypassRegistrations()"
              >
                <i class="bi bi-arrow-clockwise"></i> Refresh
              </button>
            </div>

            <!-- Filter Tabs -->
            <ul class="nav nav-tabs mb-3">
              <li class="nav-item">
                <a
                  class="nav-link active"
                  href="#"
                  onclick="filterBypassRegistrations('all')"
                >
                  All
                  <span class="badge bg-secondary" id="bypass-count-all"
                    >0</span
                  >
                </a>
              </li>
              <li class="nav-item">
                <a
                  class="nav-link"
                  href="#"
                  onclick="filterBypassRegistrations('pending')"
                >
                  Pending
                  <span class="badge bg-warning" id="bypass-count-pending"
                    >0</span
                  >
                </a>
              </li>
              <li class="nav-item">
                <a
                  class="nav-link"
                  href="#"
                  onclick="filterBypassRegistrations('approved')"
                >
                  Approved
                  <span class="badge bg-success" id="bypass-count-approved"
                    >0</span
                  >
                </a>
              </li>
              <li class="nav-item">
                <a
                  class="nav-link"
                  href="#"
                  onclick="filterBypassRegistrations('rejected')"
                >
                  Rejected
                  <span class="badge bg-danger" id="bypass-count-rejected"
                    >0</span
                  >
                </a>
              </li>
            </ul>

            <!-- Bypass Registrations Table -->
            <div class="table-responsive">
              <table class="table table-hover">
                <thead class="table-light">
                  <tr>
                    <th>Serial Number</th>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Service</th>
                    <th>Status</th>
                    <th>Submitted</th>
                    <th>Updated</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="bypass-table-body">
                  <tr>
                    <td colspan="7" class="text-center">
                      <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- License Config Section -->
          <div
            id="license-section"
            class="content-section"
            style="display: none"
          >
            <div class="d-flex justify-content-between align-items-center mb-4">
              <h2><i class="bi bi-key"></i> Global License Control</h2>
              <button class="btn btn-success" onclick="saveLicenseConfig()">
                <i class="bi bi-save"></i> Save Changes
              </button>
            </div>

            <div class="alert alert-info">
              <i class="bi bi-info-circle"></i>
              <strong>Control Global:</strong> Habilita/deshabilita la app para
              TODOS los usuarios instantáneamente.
            </div>

            <div class="card">
              <div class="card-body">
                <div class="mb-4">
                  <label class="form-label"><strong>App Status</strong></label>
                  <select
                    class="form-select form-select-lg"
                    id="license-app-enabled"
                  >
                    <option value="true">
                      ✅ ENABLED - App funciona normalmente
                    </option>
                    <option value="false">
                      ❌ DISABLED - App bloqueada para todos
                    </option>
                  </select>
                  <small class="text-muted"
                    >Si está deshabilitada, nadie podrá usar la app</small
                  >
                </div>

                <div class="mb-4">
                  <label class="form-label"
                    ><strong>Minimum Version Required</strong></label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="license-min-version"
                    placeholder="1.0.0"
                  />
                  <small class="text-muted"
                    >Versiones anteriores a esta serán bloqueadas
                    automáticamente</small
                  >
                </div>

                <div class="mb-4">
                  <label class="form-label"
                    ><strong>Disabled Message</strong></label
                  >
                  <textarea
                    class="form-control"
                    id="license-disabled-message"
                    rows="4"
                    placeholder="Esta versión de AREPA-TOOL ha sido desactivada..."
                  ></textarea>
                  <small class="text-muted"
                    >Este mensaje se mostrará cuando la app esté deshabilitada o
                    la versión sea antigua</small
                  >
                </div>

                <div class="alert alert-warning">
                  <i class="bi bi-exclamation-triangle"></i>
                  <strong>Importante:</strong> Los cambios se aplican
                  inmediatamente. Todos los usuarios verán el nuevo estado al
                  abrir la app.
                </div>
              </div>
            </div>
          </div>

          <!-- APK Manager Section -->
          <div id="apkmanager-section" class="content-section" style="display: none">
            <div class="d-flex justify-content-between align-items-center mb-4">
              <h2><i class="bi bi-box-seam"></i> APK Manager</h2>
              <div>
                <button class="btn btn-primary" onclick="showAddApkModal()">
                  <i class="bi bi-plus-circle"></i> Add APK
                </button>
                <button class="btn btn-outline-secondary ms-2" onclick="refreshApkCatalog()">
                  <i class="bi bi-arrow-clockwise"></i> Refresh
                </button>
              </div>
            </div>

            <!-- Category Filter -->
            <ul class="nav nav-tabs mb-3">
              <li class="nav-item">
                <a class="nav-link active" href="#" onclick="filterApks('all')">
                  All <span class="badge bg-secondary" id="apk-count-all">0</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#" onclick="filterApks('root')">
                  Root <span class="badge bg-success" id="apk-count-root">0</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#" onclick="filterApks('banking')">
                  Banking <span class="badge bg-info" id="apk-count-banking">0</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#" onclick="filterApks('tools')">
                  Tools <span class="badge bg-warning" id="apk-count-tools">0</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#" onclick="filterApks('general')">
                  General <span class="badge bg-secondary" id="apk-count-general">0</span>
                </a>
              </li>
            </ul>

            <!-- APK Table -->
            <div class="table-responsive">
              <table class="table table-hover">
                <thead class="table-light">
                  <tr>
                    <th>Icon</th>
                    <th>Name</th>
                    <th>Version</th>
                    <th>Package</th>
                    <th>Category</th>
                    <th>Size</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="apk-table-body">
                  <tr>
                    <td colspan="8" class="text-center">
                      <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- Upload Instructions -->
            <div class="alert alert-info mt-3">
              <i class="bi bi-info-circle"></i>
              <strong>Instrucciones:</strong> 
              <ol class="mb-0 mt-2">
                <li>Sube el APK al bucket <code>arepatool-apks</code> en Cloudflare R2</li>
                <li>Sube el icono (PNG) al bucket <code>arepatool-icons</code></li>
                <li>Registra la app aquí con los nombres exactos de los archivos</li>
              </ol>
            </div>
          </div>

          <!-- Resellers Section -->
          <div id="resellers-section" class="content-section" style="display: none">
            <div class="d-flex justify-content-between align-items-center mb-4">
              <h2><i class="bi bi-people-fill"></i> Resellers Management</h2>
              <div>
                <button class="btn btn-primary" onclick="showAddResellerModal()">
                  <i class="bi bi-plus-circle"></i> Add Reseller
                </button>
                <button class="btn btn-outline-secondary ms-2" onclick="refreshResellers()">
                  <i class="bi bi-arrow-clockwise"></i> Refresh
                </button>
              </div>
            </div>

            <!-- Reseller Stats -->
            <div class="row mb-4">
              <div class="col-md-4">
                <div class="card text-center bg-light">
                  <div class="card-body">
                    <h5 class="card-title">Total Resellers</h5>
                    <h2 class="text-primary" id="stat-total-resellers">0</h2>
                  </div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="card text-center bg-light">
                  <div class="card-body">
                    <h5 class="card-title">Total Balance</h5>
                    <h2 class="text-success" id="stat-total-balance">$0</h2>
                  </div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="card text-center bg-light">
                  <div class="card-body">
                    <h5 class="card-title">Total Orders</h5>
                    <h2 class="text-info" id="stat-total-orders">0</h2>
                  </div>
                </div>
              </div>
            </div>

            <!-- Resellers Table -->
            <div class="table-responsive">
              <table class="table table-hover">
                <thead class="table-light">
                  <tr>
                    <th>Username</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Balance</th>
                    <th>Price/License</th>
                    <th>Orders</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="resellers-table-body">
                  <tr>
                    <td colspan="8" class="text-center">
                      <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- Instructions -->
            <div class="alert alert-info mt-3">
              <i class="bi bi-info-circle"></i>
              <strong>API URL:</strong> <code>https://api.arepatool.com</code><br>
              Cada reseller tiene su propia API Key. Cuando procesan órdenes, el costo se descuenta de su balance.
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- User Action Modal -->
    <div class="modal fade" id="userActionModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalTitle">User Action</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label">Username</label>
              <input
                type="text"
                class="form-control"
                id="modal-username"
                readonly
              />
            </div>
            <div class="mb-3">
              <label class="form-label">Status</label>
              <select class="form-select" id="modal-status">
                <option value="pending">Pending</option>
                <option value="active">Active</option>
                <option value="suspended">Suspended</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">Subscription End Date</label>
              <input
                type="date"
                class="form-control"
                id="modal-subscription-end"
              />
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button
              type="button"
              class="btn btn-primary"
              onclick="saveUserChanges()"
            >
              Save Changes
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Version Modal -->
    <div class="modal fade" id="addVersionModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Add New Version</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label">Version Number *</label>
              <input
                type="text"
                class="form-control"
                id="version-number"
                placeholder="1.0.0"
              />
            </div>
            <div class="mb-3">
              <label class="form-label">Download URL *</label>
              <input
                type="url"
                class="form-control"
                id="version-url"
                placeholder="https://github.com/..."
              />
            </div>
            <div class="mb-3">
              <label class="form-label">Changelog</label>
              <textarea
                class="form-control"
                id="version-changelog"
                rows="5"
                placeholder="What's new in this version..."
              ></textarea>
            </div>
            <div class="mb-3 form-check">
              <input
                type="checkbox"
                class="form-check-input"
                id="version-mandatory"
              />
              <label class="form-check-label" for="version-mandatory">
                Mandatory Update (Users must update to continue)
              </label>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button
              type="button"
              class="btn btn-primary"
              onclick="saveNewVersion()"
            >
              Create Version
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Announcement Modal -->
    <div class="modal fade" id="addAnnouncementModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Create Announcement</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label">Title *</label>
              <input
                type="text"
                class="form-control"
                id="announcement-title"
                placeholder="Announcement title"
              />
            </div>
            <div class="mb-3">
              <label class="form-label">Message *</label>
              <textarea
                class="form-control"
                id="announcement-message"
                rows="4"
                placeholder="Announcement message..."
              ></textarea>
            </div>
            <div class="row">
              <div class="col-md-4 mb-3">
                <label class="form-label">Type</label>
                <select class="form-select" id="announcement-type">
                  <option value="info">Info</option>
                  <option value="warning">Warning</option>
                  <option value="error">Error</option>
                  <option value="success">Success</option>
                </select>
              </div>
              <div class="col-md-4 mb-3">
                <label class="form-label">Priority</label>
                <input
                  type="number"
                  class="form-control"
                  id="announcement-priority"
                  value="0"
                  min="0"
                  max="100"
                />
              </div>
              <div class="col-md-4 mb-3">
                <label class="form-label">Target Users</label>
                <select class="form-select" id="announcement-target">
                  <option value="all">All Users</option>
                  <option value="active">Active Only</option>
                  <option value="pending">Pending Only</option>
                </select>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">Start Date (Optional)</label>
                <input
                  type="datetime-local"
                  class="form-control"
                  id="announcement-start"
                />
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">End Date (Optional)</label>
                <input
                  type="datetime-local"
                  class="form-control"
                  id="announcement-end"
                />
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button
              type="button"
              class="btn btn-primary"
              onclick="saveNewAnnouncement()"
            >
              Create Announcement
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Add/Edit APK Modal -->
    <div class="modal fade" id="addApkModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="apkModalTitle">Add New APK</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="apk-edit-id">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">Name *</label>
                <input type="text" class="form-control" id="apk-name" placeholder="Magisk 29">
              </div>
              <div class="col-md-3 mb-3">
                <label class="form-label">Version *</label>
                <input type="text" class="form-control" id="apk-version" placeholder="29.0">
              </div>
              <div class="col-md-3 mb-3">
                <label class="form-label">Size (MB)</label>
                <input type="number" class="form-control" id="apk-size" placeholder="12.5" step="0.1">
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">APK File Name *</label>
                <input type="text" class="form-control" id="apk-file" placeholder="Magisk-v29.apk">
                <small class="text-muted">Nombre exacto del archivo en R2</small>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Icon File Name</label>
                <input type="text" class="form-control" id="apk-icon" placeholder="magisk.png">
                <small class="text-muted">Nombre exacto del icono en R2</small>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">Package Name</label>
                <input type="text" class="form-control" id="apk-package" placeholder="com.topjohnwu.magisk">
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Category</label>
                <select class="form-select" id="apk-category">
                  <option value="root">Root</option>
                  <option value="banking">Banking</option>
                  <option value="tools">Tools</option>
                  <option value="system">System</option>
                  <option value="general" selected>General</option>
                </select>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">Description</label>
              <textarea class="form-control" id="apk-description" rows="2" placeholder="Brief description of the app..."></textarea>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="apk-active" checked>
              <label class="form-check-label" for="apk-active">Active (visible for users)</label>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="saveApk()">Save APK</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Add/Edit Reseller Modal -->
    <div class="modal fade" id="addResellerModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title" id="resellerModalTitle"><i class="bi bi-person-plus"></i> Add New Reseller</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="reseller-edit-id">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">Username *</label>
                <input type="text" class="form-control" id="reseller-username" placeholder="gsmxpert">
                <small class="text-muted">Used as API username</small>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Name *</label>
                <input type="text" class="form-control" id="reseller-name" placeholder="GSM Xpert">
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">Email</label>
                <input type="email" class="form-control" id="reseller-email" placeholder="contact@example.com">
              </div>
              <div class="col-md-3 mb-3">
                <label class="form-label">Initial Balance ($)</label>
                <input type="number" class="form-control" id="reseller-balance" value="0" step="0.01" min="0">
              </div>
              <div class="col-md-3 mb-3">
                <label class="form-label">Price/License ($)</label>
                <input type="number" class="form-control" id="reseller-price" value="14.99" step="0.01" min="0">
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">Status</label>
              <select class="form-select" id="reseller-status">
                <option value="active">Active</option>
                <option value="suspended">Suspended</option>
              </select>
            </div>
            <div id="reseller-api-key-section" class="alert alert-success d-none">
              <strong>API Key:</strong>
              <code id="reseller-api-key-display" class="d-block mt-2 p-2 bg-dark text-white rounded"></code>
              <button class="btn btn-sm btn-outline-dark mt-2" onclick="copyApiKey()">
                <i class="bi bi-clipboard"></i> Copy
              </button>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="saveReseller()">
              <i class="bi bi-save"></i> Save Reseller
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Balance Modal -->
    <div class="modal fade" id="addBalanceModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header bg-success text-white">
            <h5 class="modal-title"><i class="bi bi-plus-circle"></i> Add Balance</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="balance-reseller-id">
            <p><strong>Reseller:</strong> <span id="balance-reseller-name"></span></p>
            <p><strong>Current Balance:</strong> $<span id="balance-current"></span></p>
            <div class="mb-3">
              <label class="form-label">Amount to Add ($)</label>
              <input type="number" class="form-control" id="balance-amount" min="0" step="0.01" value="100">
            </div>
            <div class="mb-3">
              <label class="form-label">Description</label>
              <input type="text" class="form-control" id="balance-description" placeholder="Payment received">
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-success" onclick="addBalance()">
              <i class="bi bi-plus-circle"></i> Add Balance
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="app.js"></script>
  </body>
</html>
